Bootstrap: docker
From: ubuntu:22.04

%environment
    export TERM=xterm
    export DEBIAN_FRONTEND=noninteractive
%post
    # Install dependencies
    apt-get update && apt-get install -y \
    build-essential \
    openmpi-bin \
    openmpi-common \
    cmake \
    libopenmpi-dev
                      
    # Set the working directory
    mkdir -p /app
    cd /app

    # Clean up
    cd /app
    rm -rf googletest

%files
    . /app

%post
    cd /app
    mkdir -p build
    cd build
    cmake ..
    make

%runscript
    cd /app/build
    ctest --output-on-failure